'use strict';

var getDb = require('mj-connect');

/**
 * get a customer details from customers collection
 * @params json: query, function: _cb
 * @returns 
*/
function findOne(query,_cb) {
	getDb(function(err, db) {
		if (err) {
			return _cb(err);
		}
		db.collection('customers').find(query, function(err, results) {
			if (err) {
				return _cb(err);
			}
			results.toArray(function(err, items){
				if (err) {
					return _cb(err);
				}
				return _cb(null, items);
			});
		});
	});
}

/**
 * find all customer details from customers collection
 * @params function: _cb
 * @returns 
*/
function findAll(_cb) {
	getDb(function(err, db) {
		if (err) {
			return _cb(err);
		}
		db.collection('customers').find({}, function(err, results) {
			if (err) {
				return _cb(err);
			}

			results.toArray(function(err, items){
				if (err) {
					return _cb(err);
				}
				return _cb(null, items);
			});
		});
	});
}

/**
 * ave new customer details into customers collection
 * @params json: data, function: _cb
 * @returns 
*/
function save(data,_cb) {
	getDb(function(err, db) {
    	if (err) {
			return _cb(err);
    	}
		db.collection('customers').insert(data, function(err, results) {
			if (err) {
				return _cb(err);
			}
			return _cb(null, results);
		});
	});
}

/**
 * update a customer details into customers collection
 * @params json: query, json: setData, function: _cb
 * @returns 
*/
function update(query,setData,_cb) {
	getDb(function(err, db) {
		if (err) {
			return _cb(err);
		}
		db.collection('customers').update(query, setData, function(err, results) {
			if (err) {
				return _cb(err);
			}
			return _cb(null, results);
		});
	});
}

module.exports = {
	findOne: findOne,
	findAll: findAll,
	save: save,
	update: update
}

